import { NGSettings } from '../types';

type BookmarkletUserConfig = Partial<Pick<NGSettings, 'trimBlankLine' | 'removeEmoji'>> & {
  avoidNgLevel?: 0 | 1 | 2 | 3;
};

declare global {
  interface Window {
    TWITTER_COPY_USER_CONFIG?: BookmarkletUserConfig;
  }
}

const USER_CONFIG: BookmarkletUserConfig = typeof window !== 'undefined'
  ? window.TWITTER_COPY_USER_CONFIG ?? {}
  : {};

const NG_LEVELS: Array<0 | 1 | 2 | 3> = [0, 1, 2, 3];

const resolveNgLevel = (level: unknown, fallback: 0 | 1 | 2 | 3): 0 | 1 | 2 | 3 => {
  if (typeof level === 'number' && NG_LEVELS.includes(level as 0 | 1 | 2 | 3)) {
    return level as 0 | 1 | 2 | 3;
  }
  return fallback;
};

export const DEFAULT_SETTINGS: NGSettings = {
  level: resolveNgLevel(USER_CONFIG.avoidNgLevel, 0),
  removeEmoji: USER_CONFIG.removeEmoji ?? false,
  trimBlankLine: USER_CONFIG.trimBlankLine ?? 128,
  ngUrls: [
    /(https?:\/\/note\.mu\/?[^\s]*)/g,
    /(https?:\/\/.*amazon\.co[^\s]*)/g,
    /(https?:\/\/.*amazon\.jp\/?[^\s]*)/g,
    /(https?:\/\/seed\.online\/?[^\s]*)/g,
    /(https?:\/\/.*hatenablog\.com\/?[^\s]*)/g,
    /(https?:\/\/bit\.ly\/?[^\s]*)/g,
    /(https?:\/\/pr5\.work\/?[^\s]*)/g,
    /(https?:\/\/ow\.ly\/?[^\s]*)/g,
    /(https?:\/\/buff\.ly\/?[^\s]*)/g,
    /(https?:\/\/.+\.shop\/?[^\s]*)/g,
    /(https?:\/\/ur0\.link\/?[^\s]*)/g,
    /(https?:\/\/goo\.gl\/?[^\s]*)/g,
    /(https?:\/\/discord\.gg\/?[^\s]*)/g,
    /(https?:\/\/t\.co\/?[^\s]*)/g,
    /(https?:\/\/lineblog\.me\/?[^\s]*)/g,
    /(https?:\/\/db\.tt\/?[^\s]*)/g,
    /(https?:\/\/.*getuploader\.com\/?[^\s]*)/g,
    /(https?:\/\/.*r10\.to\/?[^\s]*)/g,
    /(https?:\/\/mjk\.ac\/?[^\s]*)/g,
    /(https?:\/\/kisu\.me\/?[^\s]*)/g,
    /(https?:\/\/j55\.pw\/?[^\s]*)/g,
    /(https?:\/\/j\.mp\/?[^\s]*)/g,
    /(https?:\/\/www\d?\.to\/?[^\s]*)/g,
    /(https?:\/\/ux\.nu\/?[^\s]*)/g,
    /(https?:\/\/urx\d?\.nu\/?[^\s]*)/g,
    /(https?:\/\/p\.tl\/?[^\s]*)/g,
    /(https?:\/\/amba\.to\/?[^\s]*)/g,
    /(https?:\/\/amzn\.to\/?[^\s]*)/g,
    /(https?:\/\/appsto\.re\/?[^\s]*)/g,
    /(https?:\/\/dlvr\.it\/?[^\s]*)/g,
    /(https?:\/\/kuku\.lu\/?[^\s]*)/g,
    /(https?:\/\/linkclub\.jp\/?[^\s]*)/g,
    /(https?:\/\/.*sakura.ne.jp\/?[^\s]*)/g,
    /(https?:\/\/.*wixsite.com\/?[^\s]*)/g,
    /(https?:\/\/kakuyomu\.jp\/?[^\s]*)/g,
    /(https?:\/\/.*syosetu\.com\/?[^\s]*)/g,
    /(https?:\/\/.*stores\.jp\/?[^\s]*)/g,
    /(https?:\/\/.*shop-pro\.jp\/?[^\s]*)/g,
    /(https?:\/\/.*webmoney\.jp\/?[^\s]*)/g,
    /(https?:\/\/.*\.live\.nicovideo\.jp\/?[^\s]*)/g,
    /(https?:\/\/.*linkco\.re\/?[^\s]*)/g,
    /(https?:\/\/.*lin\.ee\/?[^\s]*)/g,
    /(https?:\/\/.*onl\.tw\/?[^\s]*)/g,
    /(https?:\/\/.*onl\.la\/?[^\s]*)/g,
    /(https?:\/\/.*onl\.bz\/?[^\s]*)/g,
    /(https?:\/\/.*onl\.sc\/?[^\s]*)/g,
    /(https?:\/\/.*tinyurl\.com\/?[^\s]*)/g,
    /(https?:\/\/.*openrec\.tv\/?[^\s]*)/g,
    /(https?:\/\/.*cloudfront\.net\/?[^\s]*)/g,
    /(https?:\/\/.*fc2\.com\/?[^\s]*)/g,
    /(https?:\/\/is\.gd\/?[^\s]*)/g,
    /(https?:\/\/.*\/\?id=\d+[^\s]*)/g,
    /(https?:\/\/yt\.be\/?[^\s]*)/g,
    /(https?:\/\/.*twitch\.tv\/?[^\s]*)/g,
    /(https?:\/\/.*campaign[^\s]*)/g,
    /(https?:\/\/.*tiktok\.com\/?[^\s]*)/g,
    /(https?:\/\/.*nicovideo\.jp\/?[^\s]*)/g,
    /(https?:\/\/.*discord\.com\/?[^\s]*)/g,
  ],
  ngWords: [
    { before: /拡散希望/g, after: '拡/散/希/望' },
    { before: /拡散お願い/g, after: '拡/散/お/願/い' },
    { before: /(https?:\/\/marshmallow-qa\.com\/?[^?]+)\?[^\s]+/g, after: '$1' },
    { before: /(utm_)(source|medium|term|campaign|content)/g, after: '$1.$2' },
    { before: /鈴原/g, after: '鈴.原' },
    { before: /無料/g, after: '無.料' },
    { before: /\.{3}/g, after: '…' },
    { before: /(_ ?){2,}/g, after: '_' },
    { before: /(- ?){2,}/g, after: '-' },
    { before: /(= ?){2,}/g, after: '=' },
    { before: /(; ?){3,}/g, after: ';;' },
    { before: /(: ?){3,}/g, after: '::' },
    { before: /&lt;/g, after: '<' },
    { before: /&gt;/g, after: '>' },
    { before: /&amp;/g, after: '&' },
    { before: /&quot;/g, after: '"' },
    { before: / +/g, after: ' ' },
    { before: new RegExp('\\u3000+', 'g'), after: '\u3000' },
    { before: /(\d{2,})(円)/g, after: '$1.$2' },
    { before: /登録/g, after: '登.録' },
    { before: /(く.{1,2}[ぽポ])([んン])/g, after: '$1.$2' },
    { before: /キャンペーン/g, after: 'キャン.ペーン' },
    { before: /コード/g, after: 'コー.ド' },
    { before: /K5/g, after: 'K.5' },
    { before: /常闇/g, after: 'とこやみ' },
    { before: /tokoyami/g, after: 'toko.yami' },
  ],
  ngQueryParams: [
    /utm_(source|medium|term|campaign|content)/,
  ],
  ngDomains: [
    'amazon',
    'amzn',
    /\.{3}/,
    /_{4,}/,
    /-{4,}/,
  ],
  replaceEmoji: [
    { before: /\u{203c}/ug, after: '!!' },
    { before: /\u{2049}/ug, after: '!?' },
    { before: /\u{1f195}/ug, after: '[NEW]' },
    { before: /\u{1f202}/ug, after: 'サ' },
    { before: /\u{1f522}/ug, after: '1234' },
    { before: /\u{1f197}/ug, after: '[OK]' },
    { before: /\u{1f196}/ug, after: '[NG]' },
    { before: /\u{1f193}/ug, after: '[FREE]' },
    { before: /\u{1f192}/ug, after: '[COOL]' },
    { before: /\u{1f199}/ug, after: '[UP!]' },
    { before: /\u{1f201}/ug, after: 'ｺｺ' },
    { before: /\u{1f233}/ug, after: '空' },
    { before: /\u{1f17f}/ug, after: 'Ｐ' },
    { before: /\u{1f251}/ug, after: '可' },
    { before: /\u{1f250}/ug, after: '得' },
    { before: /\u{3299}/ug, after: '秘' },
    { before: /\u{3297}/ug, after: '祝' },
    { before: /\u{1f234}/ug, after: '合' },
    { before: /\u{1f235}/ug, after: '満' },
    { before: /\u{1f239}/ug, after: '割' },
    { before: /\u{1f232}/ug, after: '禁' },
    { before: /\u{1f170}/ug, after: 'A' },
    { before: /\u{1f171}/ug, after: 'B' },
    { before: /\u{1f18e}/ug, after: 'AB' },
    { before: /\u{1f191}/ug, after: 'CL' },
    { before: /\u{1f17e}/ug, after: 'O' },
    { before: /\u{1f198}/ug, after: '[SOS]' },
    { before: /\u{2b55}/ug, after: '○' },
    { before: /\u{274c}/ug, after: '×' },
    { before: /\u{2757}/ug, after: '!' },
    { before: /\u{2755}/ug, after: '!' },
    { before: /\u{2753}/ug, after: '?' },
    { before: /\u{2754}/ug, after: '?' },
    { before: /\u{26a0}/ug, after: '!' },
    { before: /\u{1f22f}/ug, after: '指' },
    { before: /\u{1f19a}/ug, after: 'VS' },
    { before: /\u{1f194}/ug, after: 'ID' },
    { before: /\u{1f51f}/ug, after: '10' },
    { before: /\u{1f236}/ug, after: '有' },
    { before: /\u{1f21a}/ug, after: '無' },
    { before: /\u{1f238}/ug, after: '申' },
    { before: /\u{1f23a}/ug, after: '営' },
    { before: /\u{1f237}/ug, after: '月' },
    { before: /\u{a9}/ug, after: '(C)' },
    { before: /\u{ae}/ug, after: '(R)' },
    { before: /\u{2122}/ug, after: '(TM)' },
    { before: /[\u{25b6}\u{25B7}]/ug, after: '>' },
    { before: /[\u{25C0}\u{25C1}]/ug, after: '<' },
    { before: /[\u{2798}-\u{27af}\u{27B1}-\u{27BE}\u{21E8}]/ug, after: '→' },
    { before: /[\u{2B05}\u{2B30}-\u{2B42}\u{21E6}]/ug, after: '←' },
    { before: /[\u{2B06}\u{21E7}]/ug, after: '↑' },
    { before: /[\u{2B07}\u{21E9}]/ug, after: '↓' },
    { before: /[\u{1f53c}\u{1F53A}]/ug, after: '▲' },
    { before: /[\u{1F53B}\u{1F53D}]/ug, after: '▼' },
    { before: /\u{2139}/ug, after: 'i' },
    { before: /[\u{1F3B5}\u{1F3B6}\u{2669}]/ug, after: '♪' },
    { before: /\u{2795}/ug, after: '＋' },
    { before: /\u{2796}/ug, after: '－' },
    { before: /\u{2797}/ug, after: '÷' },
    { before: /\u{2716}/ug, after: '×' },
    { before: /\u{1F4B2}/ug, after: '$' },
    { before: /\u{146D}/ug, after: 'P' },
    { before: /\u{157C}/ug, after: 'H' },
    { before: /\u{1587}/ug, after: 'R' },
    { before: /\u{15E9}/ug, after: 'A' },
    { before: /\u{15EA}/ug, after: 'D' },
    { before: /\u{15F0}/ug, after: 'M' },
    { before: /\u{15F7}/ug, after: 'B' },
    { before: /\u{2022}/ug, after: '・' },
    { before: /\u{301C}/ug, after: '～' },
    { before: /\u{2751}/ug, after: '□' },
    { before: /\u{795C}/ug, after: '示古' },
  ],
  unicodeOffset: [
    [/[\u{2776}-\u{277F}]/ug, 10053],
    [/\u{24FF}/ug, 9423],
    [/[\u{24EB}-\u{24F4}]/ug, 129],
    [/[\u{1f150}-\u{1f169}]/ug, 127247],
    [/[\u{24B6}-\u{24CF}]/ug, 9333],
    [/[\u{24D0}-\u{24E9}]/ug, 9327],
    [/[\u{1d400}-\u{1d419}]/ug, 119743],
    [/[\u{1d41a}-\u{1d433}]/ug, 119737],
    [/[\u{1d7ce}-\u{1d7d7}]/ug, 120734],
    [/[\u{1d56c}-\u{1d585}]/ug, 120107],
    [/[\u{1d586}-\u{1d59f}]/ug, 120101],
    [/[\u{1d468}-\u{1d481}]/ug, 119847],
    [/[\u{1d482}-\u{1d49b}]/ug, 119841],
    [/[\u{1d4d0}-\u{1d4e9}]/ug, 119951],
    [/[\u{1d4ea}-\u{1d503}]/ug, 119945],
    [/[\u{2124}]/ug, 8394],
    [/[\u{1d552}-\u{1d56b}]/ug, 120049],
    [/[\u{1d7d8}-\u{1d7e1}]/ug, 120744],
    [/[\u{1d670}-\u{1d689}]/ug, 120367],
    [/[\u{1d68a}-\u{1d6a3}]/ug, 120361],
    [/[\u{1d7f6}-\u{1d7ff}]/ug, 120774],
    [/[\u{1d5a0}-\u{1d5b9}]/ug, 120159],
    [/[\u{1d5ba}-\u{1d5d3}]/ug, 120153],
    [/[\u{1d7e2}-\u{1d7eb}]/ug, 120754],
    [/[\u{1d5d4}-\u{1d5ed}]/ug, 120211],
    [/[\u{1d5ee}-\u{1d607}]/ug, 120205],
    [/[\u{1d7ec}-\u{1d7f5}]/ug, 120764],
    [/[\u{1d63c}-\u{1d655}]/ug, 120315],
    [/[\u{1d656}-\u{1d66f}]/ug, 120309],
    [/[\u{1d608}-\u{1d621}]/ug, 120263],
    [/[\u{1d622}-\u{1d63b}]/ug, 120257],
    [/[\u{249c}-\u{24b5}]/ug, 9275],
    [/[\u{2474}-\u{247c}]/ug, 9283],
    [/[\u{1f1e6}-\u{1f1ff}]/ug, 127397],
    [/[\u{1f130}-\u{1f149}]/ug, 127215],
    [/[\u{1f170}-\u{1f189}]/ug, 127279],
    [/[\u{1d538}-\u{1d550}]/ug, 120055],
    [/[\u{2102}]/ug, 8383],
    [/[\u{210d}]/ug, 8389],
    [/[\u{2115}]/ug, 8391],
    [/[\u{2119}-\u{211a}]/ug, 8393],
    [/[\u{211d}]/ug, 8395],
    [/[\u{2124}]/ug, 8394],
    [/[\u{1d434}-\u{1d44d}]/ug, 119795],
    [/[\u{1d44e}-\u{1d467}]/ug, 119789],
    [/[\u{1d49c}-\u{1d4b5}]/ug, 119899],
    [/[\u{1d4b6}-\u{1d4cf}]/ug, 119893],
    [/[\u{1d504}-\u{1d51c}]/ug, 120003],
    [/[\u{1d51e}-\u{1d537}]/ug, 119997],
  ],
};

export const SPACE_STATE_MAP = {
  'Ended': '終了済',
  'TimedOut': '終了済',
  'Running': 'ライブ中',
  'NotStarted': '開始待ち',
} as const;

export const EMOJI_REGEXP_SUB = /(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\u0023-\u0039]\ufe0f?\u20e3|\u3299|\u3297|[\u3004\u3016-\u301C\u301E\u3020-\u303F]|\u24c2|\ud83c[\udd70-\udd71]|\ud83c[\udd7e-\udd7f]|\ud83c\udd8e|\ud83c[\udd91-\udd9a]|\ud83c[\udde6-\uddff]|\ud83c[\ude01-\ude02]|\ud83c\ude1a|\ud83c\ude2f|\ud83c[\ude32-\ude3a]|\ud83c[\ude50-\ude51]|[\u0081-\u009F\u00A1-\u00A4\u00A6\u00A9-\u00AF\u00B2\u00B3\u00B5\u00B7-\u00D6\u00D8-\u00F6\u00F8-\u00FF]|[\u2000-\u200F\u2011-\u2014\u2016\u2017\u201A\u201B\u201E\u201F\u2022-\u2024\u2027-\u202F\u2031\u2034-\u203A\u203C\u203D\u203F-\u206F]|[\u2070-\u20CF]|[\u2201\u2204-\u2206\u2209\u220A\u220C-\u2210\u2213-\u2219\u221B\u221C\u2221-\u2224\u2226\u222D\u222F-\u2233\u2236-\u223C\u223E-\u2251\u2253-\u225F\u2262-\u2265\u2268\u2269\u226C-\u2281\u2284\u2285\u2288-\u22A4\u22A6-\u22BE\u22C0-\u22FF]|[\u2440-\u245F]|[\u2474-\u24FF]|[\u2504-\u250B\u250D\u250E\u2511\u2512\u2515\u2516\u2519\u251A\u251E\u251F\u2521\u2522\u2526\u2527\u2529\u252A\u252D\u252E\u2531\u2532\u2535\u2536\u2539\u253A\u253D\u253E\u2540\u2541\u2543-\u254A\u254C-\u257F]|[\u25A2-\u25B1\u25B4-\u25BB\u25BE-\u25C5\u25C8-\u25CA\u25CC\u25CD\u25D0-\u25EE\u25F0-\u25FF]|\u00a9|\u00ae|\u2122|\u2139|\ud83c\udc04|[\u2600-\u2604\u2607-\u263F\u2641\u2643-\u2669\u266B-\u266C\u266E\u2670-\u26FF]|\u2b05|\u2b06|\u2b07|\u2b1b|\u2b1c|\u2b50|\u2b55|\u231a|\u231b|\u2328|\u23cf|[\u23e9-\u23f3]|[\u23f8-\u23fa]|\ud83c\udccf|\u2934|\u2935|[\u2194-\u21D1\u21D3\u21D5-\u21FF]|[\u2FF0-\u2FFF]|[\uA640-\uA69F]|[\u0100-\u0390]|[\u03CA-\u0400]|[\u0452-\u1FFF]|[\uFE70-\uFEFF]|[\uA000-\uE3FF]|[\uFB00-\uFEFF])/g;

export const REMOVE_SURROGATE_CHARS = [65039, 8419];

export function createSettings(avoidNgLevel: 0 | 1 | 2 | 3): NGSettings {
  return {
    ...DEFAULT_SETTINGS,
    level: resolveNgLevel(USER_CONFIG.avoidNgLevel, avoidNgLevel),
  };
}
